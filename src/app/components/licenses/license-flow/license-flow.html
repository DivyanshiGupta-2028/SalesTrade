
<br>
<nav class="navbar navbar-expand-lg navbar-light bg-light px-3 shadow-sm w-100">
  <div class="d-flex justify-content-between align-items-center w-100">
    <app-user-bar-control
      [title]="pageTitle"
      [subtitle]="pageSubtitle"
      [license]="licenseName"
      [showBackButton]="showBackFlag"
      [showSubtitle]="true"
      [showLicenseName]="true">
    </app-user-bar-control>
  </div>
</nav>
<br>



      
    <div class="container py-3 w-50">
      <div class="card shadow-sm border p-4">

        <!-- Step 1 -->
        <div class="custom-stepper" [formGroup]="form">
          <div *ngIf="currentStep === 1" formGroupName="step1">
            <div class="row">
              <div class="col-md-4 mb-2">
                <label class="form-label" for="businessName">Business Name</label>
                <input
                  type="text"
                  class="form-control form-control-sm"
                  placeholder="Business Name"
                  formControlName="businessName" />
                <div *ngIf="form.get('step1.businessName')?.touched && form.get('step1.businessName')?.hasError('required')" class="text-danger small mt-1">
                  Business Name is required.
                </div>
              </div>

              <div class="col-md-4 mb-2">
                <label class="form-label" for="legalName">Legal Name</label>
                <input
                  type="text"
                  class="form-control form-control-sm"
                  placeholder="Legal Name"
                  formControlName="legalName" />
                <div *ngIf="form.get('step1.legalName')?.touched && form.get('step1.legalName')?.hasError('required')" class="text-danger small mt-1">
                  Legal Name is required.
                </div>
              </div>

              <div class="col-md-4 mb-2">
                <label class="form-label" for="businessType">Business Type</label>
                <select
                  id="businessType"
                  formControlName="businessType"
                  class="form-select form-select-sm">
                  <option value="">-- Select --</option>
                  <option value="Incorporated Company">Incorporated Company</option>
                  <option value="Individual">Individual</option>
                  <option value="Partnership">Partnership</option>
                  <option value="Sole Trader">Sole Trader</option>
                  <option value="Non Profit">Non Profit</option>
                </select>
                <div *ngIf="form.get('step1.businessType')?.touched && form.get('step1.businessType')?.hasError('required')" class="text-danger small mt-1">
                  Business Type is required.
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4 mb-2">
                <label class="form-label" for="taxReferenceGeneral">General Tax Ref</label>
                <input
                  type="text"
                  class="form-control form-control-sm"
                  placeholder="General Tax Ref"
                  formControlName="taxReferenceGeneral" />
                <div *ngIf="form.get('step1.taxReferenceGeneral')?.touched && form.get('step1.taxReferenceGeneral')?.hasError('required')" class="text-danger small mt-1">
                  General Tax Ref is required.
                </div>
              </div>

              <div class="col-md-4 mb-2">
                <label class="form-label" for="taxReferenceSales">Sales Tax Ref</label>
                <input
                  type="text"
                  class="form-control form-control-sm"
                  placeholder="Sales Tax Ref"
                  formControlName="taxReferenceSales" />
                <div *ngIf="form.get('step1.taxReferenceSales')?.touched && form.get('step1.taxReferenceSales')?.hasError('required')" class="text-danger small mt-1">
                  Sales Tax Ref is required.
                </div>
              </div>

              <div class="col-md-4 mb-2">
                <label class="form-label" for="kyc">KYC</label>
                <input
                  type="text"
                  class="form-control form-control-sm"
                  placeholder="KYC"
                  formControlName="kyc" />
                <div *ngIf="form.get('step1.kyc')?.touched && form.get('step1.kyc')?.hasError('required')" class="text-danger small mt-1">
                  KYC is required.
                </div>
              </div>
            </div>
          

          <div class="row">
            <div class="col-md-3 mb-2">
              <label class="form-label" for="cashRevenue">Cash Revenue</label>
              <input
                type="text"
                class="form-control form-control-sm"
                placeholder="Cash Revenue"
                formControlName="cashRevenue"
                inputmode="numeric"
                pattern="[0-9]*"
                (keypress)="allowOnlyNumbers($event)" />
              <div *ngIf="form.get('step1.cashRevenue')?.touched && form.get('step1.cashRevenue')?.hasError('required')" class="text-danger small mt-1">
                Cash Revenue is required.
              </div>
              <div *ngIf="form.get('step1.cashRevenue')?.hasError('pattern')" class="text-danger small mt-1">
                Only numbers are allowed.
              </div>
            </div>

            <div class="col-md-3 mb-2">
              <label class="form-label" for="total12MonthIncome">12-Month Income</label>
              <input
                type="number"
                class="form-control form-control-sm"
                placeholder="12-Month Income"
                formControlName="total12MonthIncome"
                inputmode="numeric"
                pattern="[0-9]*"
                (keypress)="allowOnlyNumbers($event)" />
              <div *ngIf="form.get('step1.total12MonthIncome')?.touched && form.get('step1.total12MonthIncome')?.hasError('required')" class="text-danger small mt-1">
                12-Month Income is required.
              </div>
            </div>

            <div class="col-md-3 mb-2">
              <label class="form-label" for="numberOfEmployee">No. of Employees</label>
              <input
                type="number"
                class="form-control form-control-sm"
                placeholder="No. of Employees"
                formControlName="numberOfEmployee"
                inputmode="numeric"
                pattern="[0-9]*"
                (keypress)="allowOnlyNumbers($event)" />
              <div *ngIf="form.get('step1.numberOfEmployee')?.touched && form.get('step1.numberOfEmployee')?.hasError('required')" class="text-danger small mt-1">
                Number of Employees is required.
              </div>
            </div>

            <div class="col-md-3 mb-2">
              <label class="form-label">Business Start Date</label>
              <input
                type="date"
                class="form-control form-control-sm"
                formControlName="businessStartDate" />
              <div *ngIf="form.get('step1.businessStartDate')?.touched && form.get('step1.businessStartDate')?.hasError('required')" class="text-danger small mt-1">
                Business Start Date is required.
              </div>
              <div *ngIf="form.get('step1.businessStartDate')?.hasError('afterLastRenewed')" class="text-danger small mt-1">
                Business Start Date must be earlier than Last Renewed Date.
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4 mb-2">
              <label class="form-label">Last Renewed Date</label>
              <input
                type="date"
                class="form-control form-control-sm"
                formControlName="lastRenewedDate" />
              <div *ngIf="form.get('step1.lastRenewedDate')?.touched && form.get('step1.lastRenewedDate')?.hasError('required')" class="text-danger small mt-1">
                Last Renewed Date is required.
              </div>
              <div *ngIf="form.get('step1.lastRenewedDate')?.hasError('afterRenewal')" class="text-danger small mt-1">
                Last Renewed Date must be earlier than Date Renewal.
              </div>
            </div>

            <div class="col-md-4 mb-2">
              <label class="form-label">Date Renewal</label>
              <input
                type="date"
                class="form-control form-control-sm"
                formControlName="dateRenewal" />
              <div *ngIf="form.get('step1.dateRenewal')?.touched && form.get('step1.dateRenewal')?.hasError('required')" class="text-danger small mt-1">
                Date Renewal is required.
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-end">
            <button type="button" class="btn btn-primary btn-sm" (click)="nextStep()">Next</button>
          </div>

          </div>


        <!-- Step 2 -->
          <div *ngIf="currentStep === 2" formGroupName="step2">
            <div class="mb-4">
              <h5 style="color: grey;">
                <i class="fas fa-map-marker-alt"></i> Address Information
              </h5>
              <div class="row mb-2 mt-4">
                <div class="col-md-4">
                  <label for="addressLine1" class="form-label required">Address Line 1</label>
                  <input
                    type="text"
                    id="addressLine1"
                    pattern="[a-zA-Z0-9]+"
                    title="Only alphanumeric characters are allowed"
                    formControlName="addressLine1"
                    class="form-control"
                    [class.is-invalid]="isFieldInvalid('addressLine1')"
                    placeholder="Enter Address Line 1" />
                  <div class="invalid-feedback">{{ getFieldError('addressLine1') }}</div>
                </div>
                <div class="col-md-4">
                  <label for="addressLine2" class="form-label required">Address Line 2</label>
                  <input
                    type="text"
                    id="addressLine2"
                    pattern="[a-zA-Z0-9]+"
                    title="Only alphanumeric characters are allowed"
                    formControlName="addressLine2"
                    class="form-control"
                    [class.is-invalid]="isFieldInvalid('addressLine2')"
                    placeholder="Enter Address Line 2" />
                  <div class="invalid-feedback">{{ getFieldError('addressLine2') }}</div>
                </div>
                <div class="col-md-4">
                  <label for="addressLine3" class="form-label required">Address Line 3</label>
                  <input
                    type="text"
                    id="addressLine3"
                    pattern="[a-zA-Z0-9]+"
                    title="Only alphanumeric characters are allowed"
                    formControlName="addressLine3"
                    class="form-control"
                    [class.is-invalid]="isFieldInvalid('addressLine3')"
                    placeholder="Enter Address Line 3" />
                  <div class="invalid-feedback">{{ getFieldError('addressLine3') }}</div>
                </div>
              </div>

              <div class="row mb-2">
                <div class="col-md-4">
                  <label for="addressLine4" class="form-label">Address Line 4</label>
                  <input
                    type="text"
                    id="addressLine4"
                    pattern="[a-zA-Z0-9]+"
                    title="Only alphanumeric characters are allowed"
                    formControlName="addressLine4"
                    class="form-control"
                    [class.is-invalid]="isFieldInvalid('addressLine4')"
                    placeholder="Enter address line 4" />
                  <div class="invalid-feedback">{{ getFieldError('addressLine4') }}</div>
                </div>

                <div class="col-md-4">
                  <label for="country" class="form-label required">Country</label>
                  <select
                    id="country"
                    formControlName="country"
                    class="form-select"
                    [class.is-invalid]="isFieldInvalid('country')"
                    [disabled]="isCountriesLoading">
                    <option value="">{{ isCountriesLoading ? 'Loading countries...' : 'Select Country' }}</option>
                    <option *ngFor="let country of countryOptions" [value]="country.value">{{ country.label }}</option>
                  </select>
                  <div class="invalid-feedback">{{ getFieldError('country') }}</div>
                </div>

                <div class="col-md-4">
                  <label for="state" class="form-label required">State/Province</label>
                  <select
                    id="state"
                    formControlName="state"
                    class="form-select"
                    [class.is-invalid]="isFieldInvalid('state')"
                    [disabled]="isStatesLoading || !selectedCountry">
                    <option value="">{{ isStatesLoading ? 'Loading states...' : (!selectedCountry ? 'Select country first' : 'Select State') }}</option>
                    <option *ngFor="let state of stateOptions" [value]="state.value">{{ state.label }}</option>
                    <option value="Other">Other</option>
                  </select>
                  <div class="invalid-feedback">{{ getFieldError('state') }}</div>
                </div>
              </div>

              <div class="row mb-2" *ngIf="form.get('state')?.value === 'Other'">
                <div class="col-md-4">
                  <label for="otherState" class="form-label required">Specify Other State</label>
                  <input
                    type="text"
                    id="otherState"
                    pattern="[a-zA-Z]+"
                    title="Only alphabet characters are allowed"
                    formControlName="otherState"
                    class="form-control"
                    [class.is-invalid]="isFieldInvalid('otherState')"
                    placeholder="Enter other state" />
                  <div class="invalid-feedback">{{ getFieldError('otherState') }}</div>
                </div>
              </div>

              <div class="row mb-2">
                <div class="col-md-4">
                  <label for="pincode" class="form-label required">PIN/ZIP Code</label>
                  <input
                    type="number"
                    id="pincode"
                    pattern="[0-9]+"
                    title="Only numeric characters are allowed"
                    formControlName="pincode"
                    class="form-control"
                    [class.is-invalid]="isFieldInvalid('pincode')"
                    placeholder="Enter PIN or ZIP code" />
                  <div class="invalid-feedback">{{ getFieldError('pincode') }}</div>
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-secondary btn-sm" (click)="prevStep()">Back</button>
              <button type="button" class="btn btn-primary btn-sm" (click)="nextStep()">Next</button>
            </div>
          </div>

        <!-- Step 3 -->
          <div *ngIf="currentStep === 3" formGroupName="step3">
            <div class="row mb-1 ">
              <div class="col-md-8 position-relative">
                <label class="form-label" for="website">Website</label>
                <input
                  type="text"
                  class="form-control form-control"
                  placeholder="Website"
                  formControlName="website"
                  (input)="onWebsiteInput()" />
                <ul
                  *ngIf="suggestedWebsites.length > 0"
                  class="list-group position-absolute w-100"
                  style="z-index: 1000;">
                  <li
                    *ngFor="let site of suggestedWebsites"
                    class="list-group-item list-group-item-action p-1"
                    (click)="form.get('website')?.setValue(site)">
                    {{ site }}
                  </li>
                </ul>
                <div *ngIf="form.get('step3.website')?.touched && form.get('step3.website')?.hasError('required')" class="text-danger small mt-1">
                  Website is required.
                </div>
                <div *ngIf="form.get('step3.website')?.hasError('pattern')" class="text-danger small mt-1">
                  Must be a valid URL (http:// or https://).
                </div>
              </div>

              <!-- <div class="col-md-4">
                <label for="mobile" class="form-label">Phone Number</label>
                <input
                  type="tel"
                  pattern="[0-9]+"
                  title="Only numeric characters are allowed"
                  id="mobile"
                  formControlName="mobile"
                  class="form-control"
                  [class.is-invalid]="isFieldInvalid('mobile')"
                  placeholder="Enter mobile number" />
              </div> -->
            </div>

            <div class="mb-3">
              <label class="form-label" for="profileDescription">Profile Description</label>
              <textarea
                class="form-control form-control-sm"
                rows="6"
                placeholder="Profile Description"
                formControlName="profileDescription"
                (input)="updateWordCount()"></textarea>
              <small class="text-muted">{{ profileDescriptionWordCount }}/500 words</small>
              <div *ngIf="form.get('step3.profileDescription')?.touched && form.get('step3.profileDescription')?.hasError('required')" class="text-danger small mt-1">
                Profile Description is required.
              </div>
            </div>

            <h5 class="mb-2" style="color: grey;">Localization</h5>
            <div class="row">
              <div class="col-md-3 mb-1">
                <label for="currency" class="form-label">Currency</label>
                <select
                  id="currency"
                  class="form-select"
                  formControlName="currency">
                  <option value="">Select</option>
                  <option *ngFor="let currency of (currencies$ | async)" [value]="currency.currencyId">
                    {{ currency.currencyId }}
                  </option>
                </select>
                <div *ngIf="isFieldInvalid('step3.currency')" class="text-danger small mt-1">
                  This field is required.
                </div>
              </div>

              <div class="col-md-3 mb-1">
                <label for="language" class="form-label">Language</label>
                <select
                  id="language"
                  class="form-select"
                  formControlName="language">
                  <option value="">Select</option>
                  <option *ngFor="let language of (languages$ | async)" [value]="language.languageName">
                    {{ language.languageName }}
                  </option>
                </select>
              </div>

              <div class="col-md-3 mb-2">
                <label for="localization" class="form-label">Localization</label>
                <select
                  id="localization"
                  class="form-select"
                  formControlName="localization">
                  <option value="">Select</option>
                  <option *ngFor="let currency of (currencies$ | async)" [value]="currency.currencyLocale">
                    {{ currency.currencyLocale }}
                  </option>
                </select>
              </div>
            </div>

            <div class="row">
              <!-- <div class="col-md-6 mb-4">
                <label for="referencePrefix" class="form-label">Reference Prefix</label>
                <input
                  type="text"
                  id="referencePrefix"
                  class="form-control"
                  formControlName="referencePrefix" />
                <div *ngIf="isFieldInvalid('step3.referencePrefix')" class="text-danger small mt-1">
                  This field is required.
                </div>
              </div> -->
              <div class="col-md-6 mb-4">
  <label for="referencePrefix" class="form-label">Reference Prefix</label>
  <input
    type="text"
    id="referencePrefix"
    class="form-control"
    formControlName="referencePrefix" />
    <!-- <input
  type="number"
  id="referencePrefix"
  class="form-control"
  formControlName="referencePrefix"
  [readonly]="false"
/> -->

  <div *ngIf="isFieldInvalid('step3.referencePrefix')" class="text-danger small mt-1">
    This field is required.
  </div>
</div>


              <div class="col-md-4 mb-0 d-flex align-items-center">
                <div class="form-check">
                  <input
                    type="checkbox"
                    id="isActive"
                    class="form-check-input"
                    formControlName="isActive" />
                  <label for="isActive" class="form-check-label">Is Active</label>
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-secondary btn-sm" (click)="prevStep()">Back</button>
              <button type="button" class="btn btn-primary btn-sm" (click)="nextStep()">Next</button>
            </div>
          </div>

        <!-- Step 4 -->
          <div *ngIf="currentStep === 4" formGroupName="step4">
            <h5 class="mb-3" style="color: grey;">License Details</h5>
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="licenseType" class="form-label">License Type</label>
                <select
                  id="licenseType"
                  class="form-select"
                  formControlName="licenseType">
                  <option value="">Select</option>
                  <option value="free">Free</option>
                  <option value="standard">Standard</option>
                  <option value="premium">Premium</option>
                  <option value="custom-configurable">Custom-Configurable</option>
                </select>
                <div *ngIf="isFieldInvalid('step4.licenseType')" class="text-danger small mt-1">
                  This field is required.
                </div>
              </div>

              <div class="col-md-4 mb-3">
                <label for="licenseDuration" class="form-label">License Duration</label>
                <select
                  id="licenseDuration"
                  class="form-select"
                  formControlName="licenseDuration">
                  <option value="">Select</option>
                  <option value="trial">Trial</option>
                  <option value="monthly">Monthly</option>
                  <option value="quaterly">Quarterly</option>
                  <option value="yearly">Yearly</option>
                  <option value="2year">Two-Yearly</option>
                </select>
                <div *ngIf="isFieldInvalid('step4.licenseDuration')" class="text-danger small mt-1">
                  This field is required.
                </div>
              </div>

              <div class="col-md-2 mb-3">
                <label for="renewal" class="form-label">Renewal</label>
                <select
                  id="renewal"
                  class="form-select"
                  formControlName="renewal">
                  <option value="">Select</option>
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="startDate" class="form-label">Start Date</label>
                <input
                  type="date"
                  id="startDate"
                  class="form-control"
                  formControlName="startDate" />
                <div *ngIf="isFieldInvalid('step4.startDate')" class="text-danger small mt-1">
                  Start Date is required.
                </div>
              </div>

              <div class="col-md-4 mb-3">
                <label for="endDate" class="form-label">End Date</label>
                <input
                  type="date"
                  id="endDate"
                  class="form-control"
                  formControlName="endDate" />
                <div *ngIf="isFieldInvalid('step4.endDate')" class="text-danger small mt-1">
                  End Date is required.
                </div>
              </div>
            </div>


            <div class="row">
            <div class="form-check d-flex align-items-center mb-2">
              <mat-checkbox formControlName="currentStatus"></mat-checkbox>
              <label class="form-check-label ms-2 mb-0">Current Status</label>
            </div>
            <div class="form-check d-flex align-items-center mb-2">
              <mat-checkbox formControlName="isLegalDocumentationHeld"></mat-checkbox>
              <label class="form-check-label ms-2 mb-0">Legal Documentation</label>
            </div>
            <div class="form-check d-flex align-items-center mb-2">
              <mat-checkbox formControlName="isTaxReportingExempt"></mat-checkbox>
              <label class="form-check-label ms-2 mb-0">Tax Exempt</label>
            </div>
            <div class="form-check d-flex align-items-center mb-2">
              <mat-checkbox formControlName="canSendMessages"></mat-checkbox>
              <label class="form-check-label ms-2 mb-0">Can Send Messages</label>
            </div>
            </div>
            <div class="form-check d-flex align-items-center mb-2">
              <mat-checkbox formControlName="canReceiveMessages"></mat-checkbox>
              <label class="form-check-label ms-2 mb-0">Can Receive Messages</label>
            </div>
            <div class="form-check d-flex align-items-center mb-2">
              <mat-checkbox formControlName="isListedInDirectory"></mat-checkbox>
              <label class="form-check-label ms-2 mb-0">Listed in Directory</label>
            </div>
            <div class="form-check d-flex align-items-center mb-2">
              <mat-checkbox formControlName="isListedOnWebsite"></mat-checkbox>
              <label class="form-check-label ms-2 mb-0">Listed on Website</label>
            </div>
            <div class="form-check d-flex align-items-center mb-2">
              <mat-checkbox formControlName="isActive"></mat-checkbox>
              <label class="form-check-label ms-2 mb-0">Active</label>
            </div>
            <div class="form-check d-flex align-items-center mb-2">
              <mat-checkbox formControlName="isLicenseMember"></mat-checkbox>
              <label class="form-check-label ms-2 mb-0">License Member</label>
            </div>
            <div class="form-check d-flex align-items-center mb-3">
              <mat-checkbox formControlName="hasPermissionToUseInvoiceSystem"></mat-checkbox>
              <label class="form-check-label ms-2 mb-0">Invoice System Access</label>
            </div>

            <div class="d-flex justify-content-between mt-3">
              <button type="button" class="btn btn-secondary btn-sm" (click)="prevStep()">Back</button>
              <button type="button" class="btn btn-primary btn-sm" (click)="saveLicense()">Save and Continue</button>
            </div>
          </div>

      </div>
    </div>

