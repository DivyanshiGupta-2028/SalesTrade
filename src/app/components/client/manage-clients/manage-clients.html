<div class="d-flex justify-content-center">
  <div class="container my-4 " style="max-width: 800px;">
    <div class="text-center mb-4">
      <h2><i class="fas fa-user-plus"></i>  Owner Details</h2>
    </div>

    <form [formGroup]="contactForm" (ngSubmit)="onSubmit()" class="center-form">

    <div *ngFor="let license of licenses$ | async" class="mb-3">
      <h5><b>License Parent Name: {{ license.companyName }}</b></h5>
    </div>

    <div class="mb-4">
      <h3>
        <i class="fas fa-user"></i> Personal Information
      </h3>

      <div class="row mb-4">
        <div class="col-md-4">
          <label for="title" class="form-label required">Title</label>
          <select id="title" formControlName="title" class="form-select" [class.is-invalid]="isFieldInvalid('title')">
            <option value="">Select Title</option>
            <option *ngFor="let title of titleOptions" [value]="title.value">{{ title.label }}</option>
          </select>
          <div class="invalid-feedback">{{ getFieldError('title') }}</div>
        </div>

        <div class="col-md-4">
          <label for="firstname" class="form-label required">First Name</label>
          <input type="text" pattern="[a-zA-Z0-9]+" title="Only alphanumeric characters are allowed" id="firstname" formControlName="firstname" class="form-control" [class.is-invalid]="isFieldInvalid('firstname')" placeholder="Enter First Name" />
          <div class="invalid-feedback">{{ getFieldError('firstname') }}</div>
        </div>

        <div class="col-md-4">
          <label for="lastname" class="form-label">Last Name</label>
          <input type="text" pattern="[a-zA-Z0-9]+" title="Only alphanumeric characters are allowed" id="lastname" formControlName="lastname" class="form-control" [class.is-invalid]="isFieldInvalid('lastname')" placeholder="Enter Last Name" />
          <div class="invalid-feedback">{{ getFieldError('lastname') }}</div>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col-md-6">
          <label for="emailAddress" class="form-label required">Email Address</label>
          <input type="email" id="emailAddress" formControlName="emailAddress" class="form-control" [class.is-invalid]="isFieldInvalid('emailAddress')" placeholder="Enter email address" />
          <div class="invalid-feedback">{{ getFieldError('emailAddress') }}</div>
        </div>
      </div>

      <div class="row mb-4">
        <div *ngIf="contactForm.errors?.['phoneDuplicate'] && (contactForm.dirty || contactForm.touched)" 
     class="text-danger small mt-1">
  Phone 1, Phone 2 and Mobile numbers must be unique.
</div>



        <div class="col-md-4">
          <label for="telephone1" class="form-label required">Phone 1</label>
          <input type="tel" pattern="[0-9]+" title="Only numeric characters are allowed" id="telephone1" formControlName="telephone1" class="form-control" [class.is-invalid]="isFieldInvalid('telephone1')" placeholder="Enter Phone Number" />
          <div class="invalid-feedback">{{ getFieldError('telephone1') }}</div>
        </div>

        <div class="col-md-4">
          <label for="telephone2" class="form-label">Phone 2</label>
          <input type="tel" pattern="[0-9]+" title="Only numeric characters are allowed" id="telephone2" formControlName="telephone2" class="form-control" [class.is-invalid]="isFieldInvalid('telephone2')" placeholder="Enter alternate phone" />
        </div>

        <div class="col-md-4">
          <label for="mobile" class="form-label">Mobile</label>
          <input type="tel" pattern="[0-9]+" title="Only numeric characters are allowed" id="mobile" formControlName="mobile" class="form-control" [class.is-invalid]="isFieldInvalid('mobile')" placeholder="Enter mobile number" />
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-md-4">
          <label for="departmentId" class="form-label required">Department</label>
          <select id="departmentId" formControlName="departmentId" class="form-select" [class.is-invalid]="isFieldInvalid('departmentId')" [disabled]="isDepartmentsLoading">
            <option value="">{{ isDepartmentsLoading ? 'Loading departments...' : 'Select Department' }}</option>
            <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.name }}</option>
          </select>
          <div *ngIf="isDepartmentsLoading" class="form-text"><i class="fas fa-spinner fa-spin"></i> Loading departments...</div>
          <div class="invalid-feedback">{{ getFieldError('departmentId') }}</div>
        </div>

        <div class="col-md-4">
          <label for="positionId" class="form-label required">Position Title</label>
          <select id="positionId" formControlName="positionId" class="form-select" [class.is-invalid]="isFieldInvalid('positionId')" [disabled]="isPositionsoading">
            <option value="">{{ isPositionsoading ? 'Loading positions...' : 'Select Positions' }}</option>
            <option *ngFor="let post of positions" [value]="post.id">{{ post.positionName }}</option>
            <option value="Other">Other</option>
          </select>
          <div *ngIf="isPositionsoading" class="form-text"><i class="fas fa-spinner fa-spin"></i> Loading positions...</div>
          <div class="invalid-feedback">{{ getFieldError('positionId') }}</div>
        </div>


      <div *ngIf="contactForm.get('positionId')?.value === 'Other'" class="col-md-4">
          <label for="otherPositionTitle" class="form-label required">Specify Other Position</label>
          <input id="otherPositionTitle" pattern="[a-zA-Z0-9]+" title="Only alphanumeric characters are allowed" type="text" formControlName="otherPositionTitle" class="form-control" [class.is-invalid]="isFieldInvalid('otherPositionTitle')" placeholder="Enter other position title" />
          <div class="invalid-feedback">{{ getFieldError('otherPositionTitle') }}</div>
      </div>
            </div>

      <div class="row mb-3">
        <div class="col-md-4">
          <label for="gender" class="form-label">Gender</label>
          <select id="gender" formControlName="gender" class="form-select">
            <option value="">Select Gender</option>
            <option *ngFor="let gender of genderOptions" [value]="gender.value">{{ gender.label }}</option>
          </select>
        </div>

        <div class="col-md-4">
          <label for="dateOfBirth" class="form-label">Date of Birth</label>
          <input type="date" id="dateOfBirth" [value]="defaultDate" formControlName="dateOfBirth" class="form-control" />
        </div>
      </div>
    </div>

    <!-- Address Information Section -->
    <div class="mb-4">
      <h3>
        <i class="fas fa-map-marker-alt"></i> Address Information
      </h3>

      <div class="row mb-4">
        <div class="col-md-4">
          <label for="addressLine1" class="form-label required">Address Line 1</label>
          <input type="text" id="addressLine1" pattern="[a-zA-Z0-9]+" title="Only alphanumeric characters are allowed" formControlName="addressLine1" class="form-control" [class.is-invalid]="isFieldInvalid('addressLine1')" placeholder="Enter Address Line 1" />
          <div class="invalid-feedback">{{ getFieldError('addressLine1') }}</div>
        </div>

        <div class="col-md-4">
          <label for="addressLine2" class="form-label required">Address Line 2</label>
          <input type="text" id="addressLine2" pattern="[a-zA-Z0-9]+" title="Only alphanumeric characters are allowed" formControlName="addressLine2" class="form-control" [class.is-invalid]="isFieldInvalid('addressLine2')" placeholder="Enter Address Line 2" />
          <div class="invalid-feedback">{{ getFieldError('addressLine2') }}</div>
        </div>

        <div class="col-md-4">
          <label for="addressLine3" class="form-label required">Address Line 3</label>
          <input type="text" id="addressLine3" pattern="[a-zA-Z0-9]+" title="Only alphanumeric characters are allowed" formControlName="addressLine3" class="form-control" [class.is-invalid]="isFieldInvalid('addressLine3')" placeholder="Enter Address Line 3" />
          <div class="invalid-feedback">{{ getFieldError('addressLine3') }}</div>
        </div>

        
      </div>

      <div class="row mb-4">

        <div class="col-md-4">
          <label for="addressLine4" class="form-label">Address Line 4</label>
          <input type="text" id="addressLine4" pattern="[a-zA-Z0-9]+" title="Only alphanumeric characters are allowed" formControlName="addressLine4" class="form-control" [class.is-invalid]="isFieldInvalid('addressLine4')" placeholder="Enter address line 4" />
          <div class="invalid-feedback">{{ getFieldError('addressLine4') }}</div>
        </div>
        <div class="col-md-4">
          <label for="country" class="form-label required">Country</label>
          <select id="country" formControlName="country" class="form-select" [class.is-invalid]="isFieldInvalid('country')" [disabled]="isCountriesLoading">
            <option value="">{{ isCountriesLoading ? 'Loading countries...' : 'Select Country' }}</option>
            <option *ngFor="let country of countryOptions" [value]="country.value">{{ country.label }}</option>
          </select>
          <div class="invalid-feedback">{{ getFieldError('country') }}</div>
        </div>

        <div class="col-md-4">
          <label for="state" class="form-label required">State/Province</label>
          <select id="state" formControlName="state" class="form-select" [class.is-invalid]="isFieldInvalid('state')" [disabled]="isStatesLoading || !selectedCountry">
            <option value="">{{ isStatesLoading ? 'Loading states...' : (!selectedCountry ? 'Select country first' : 'Select State') }}</option>
            <option *ngFor="let state of stateOptions" [value]="state.value">{{ state.label }}</option>
            <option value="Other">Other</option>
          </select>
          <div class="invalid-feedback">{{ getFieldError('state') }}</div>
        </div>
      </div>

      <div class="row mb-4" *ngIf="contactForm.get('state')?.value === 'Other'">
        <div class="col-md-4">
          <label for="otherState" class="form-label required">Specify Other State</label>
          <input type="text" id="otherState" pattern="[a-zA-Z]+" title="Only alphabet characters are allowed" formControlName="otherState" class="form-control" [class.is-invalid]="isFieldInvalid('otherState')" placeholder="Enter other state" />
          <div class="invalid-feedback">{{ getFieldError('otherState') }}</div>
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-md-4">
          <label for="pincode" class="form-label required">PIN/ZIP Code</label>
          <input type="number" id="pincode" pattern="[0-9]+" title="Only numeric characters are allowed" formControlName="pincode" class="form-control" [class.is-invalid]="isFieldInvalid('pincode')" placeholder="Enter PIN or ZIP code" />
          <div class="invalid-feedback">{{ getFieldError('pincode') }}</div>
        </div>
      </div>
    </div>

    <div class="mb-4">
      <h3>
        <i class="fas fa-cogs"></i> Settings
      </h3>

      <div class="row mb-6">
        <div class="col-md-6">
          <div class="form-check">
            <input type="checkbox" id="isPrimaryContact" formControlName="isPrimaryContact" class="form-check-input" />
            <label for="isPrimaryContact" class="form-check-label">Primary Contact</label>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-check">
            <input type="checkbox" id="isActive" formControlName="isActive" class="form-check-input" />
            <label for="isActive" class="form-check-label">Active Status</label>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-end mb-4 me-3">
        <button type="submit" class="btn btn-primary" [disabled]="contactForm.invalid || isLoading">
          <i class="fas" [ngClass]="isLoading ? 'fa-spinner fa-spin' : 'fa-save'"></i>
          {{ isLoading ? 'Saving...' : (isEditMode ? 'Update Contact' : 'Save and Continue') }}
        </button>
      </div>
  </form>
</div>
</div>