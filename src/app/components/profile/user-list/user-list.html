 <br>
<nav class="navbar navbar-expand-lg navbar-light bg-light px-3 shadow-sm w-100">
  <div class="d-flex justify-content-between align-items-center w-100">
    
    <app-user-bar-control
      [title]="pageTitle"
      [subtitle]="pageSubtitle"
      [showBackButton]="showBackFlag"
      [showSubtitle]="false">
    </app-user-bar-control>

<div class="input-group me-3" style="width: 350px;">
  <span class="input-group-text">
    <i class="bi bi-search"></i> 
  </span>
<input
  type="text"
  class="form-control"
  placeholder="Search"
  [(ngModel)]="searchText"
  (input)="onSearch(searchText)" />
<button
  *ngIf="searchText"
  class="btn btn-outline-secondary"
  type="button"
  (click)="cancelSearch()">
  Cancel
</button>
</div>

    <button class="btn btn-primary" (click)="openAddUserModal()">
      <i class="bi bi-plus-lg"></i> Add Firm
    </button>

  </div>
</nav>

<br> 

<div class="row">
  <div class="col-12">

    <div class="d-flex justify-content-end mb-2 align-items-center">

  <div class="d-flex align-items-center">
  <label class="me-2">Records per page:</label>
  <select class="form-select form-select-sm w-auto"
          [ngModel]="selectedPageSize"
          (change)="onPageSizeChange($event)">
    <option [value]="5">5</option>
    <option [value]="15">15</option>
    <option [value]="50">50</option>
    <option [value]="100">100</option>
    <option value="viewAll">View All</option>
  </select>
</div>

</div>

<div class="table-responsive"
     [ngStyle]="{
       'max-height': shouldScroll ? 'calc(100vh - 200px)' : 'auto',
       'overflow-y': shouldScroll ? 'auto' : 'visible'
     }">
  <table id="example" class="table table-striped table-bordered w-100 mb-0">
    <thead class="table-light" style="position: sticky; top: 0; z-index: 10; background:#f8f9fa;">
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of pagedUsers">
            <td>
              <a [routerLink]="['/view-user']" [queryParams]="{ userId: user.id }" class="text-decoration-none">
               {{ user.firstName }} {{ user.lastName }}
              </a>
            </td>
            <td>{{ user.email }}</td>

            <td>
              <div class="dropdown">
                <button 
                  class="btn btn-primary btn-sm dropdown-toggle" 
                  type="button" 
                  data-bs-toggle="dropdown" 
                  aria-expanded="false">
                  Actions
                </button>
                <ul class="dropdown-menu">
                 
                  <li  *ngIf="hasRole('SuperAdmin') | async">
                    <button 
                      class="dropdown-item text-primary" 
                      (click)="viewDetails(user.id)">
                      View Licenses
                    </button>
                  </li>
                  <li  *ngIf="hasRole('Admin') | async">
                    <button 
                      class="dropdown-item text-primary" 
                       (click)="navigateToAddUserDetails(user.id)">
                      Add User Details
                    </button>
                  </li>
                  <li  *ngIf="hasRole('Admin') | async">
                    <button 
                      class="dropdown-item text-primary" 
                       (click)="viewUserDetails(user.id)">
                      View User Details
                    </button>
                  </li>
                  <li  *ngIf="hasRole('SuperAdmin') | async">
                    <button 
                      class="dropdown-item text-primary" 
                       (click)="navigateToAddLicense(user.id)">
                      Add Licenses
                    </button>
                  </li>
                  <li>
                    <button 
                      class="dropdown-item text-danger" 
                      (click)="confirmDelete(user.id!)">
                      Remove
                    </button>
                  </li>
                </ul>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-center mt-2">
      <nav *ngIf="!viewAll && totalPages > 1" aria-label="Page navigation">
        <ul class="pagination mb-0">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link" (click)="goToPage(currentPage - 1)">Previous</button>
          </li>

          <li class="page-item" 
              *ngFor="let page of pages" 
              [class.active]="page === currentPage">
            <button class="page-link" (click)="goToPage(page)">{{ page }}</button>
          </li>

          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link" (click)="goToPage(currentPage + 1)">Next</button>
          </li>
        </ul>
      </nav>
    </div>

    <app-add-profile 
      *ngIf="showAddProfile"
      class="modal-overlay"
      (closed)="closeAddProfile()">
    </app-add-profile>

  </div> 
</div>
